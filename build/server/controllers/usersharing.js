// Generated by CoffeeScript 1.9.0
var Client, User, ds, fs, _ref;

Client = require("request-json").JsonClient;

fs = require('fs');

User = require('../models/device');

ds = new Client("http://localhost:9101/");

if ((_ref = process.env.NODE_ENV) === 'test' || _ref === 'production') {
  ds.setBasicAuth(process.env.NAME, process.env.TOKEN);
}

module.exports = {
  users: function(req, res, next) {
    return User.all(function(err, users) {
      console.log('user sharing request : ' + JSON.stringify(users));
      if (err) {
        return next(err);
      } else {
        return res.send({
          rows: users
        });
      }
    });
  },
  add: function(req, res, next) {},
  remove: function(req, res, next) {
    var id;
    id = req.params.usersharingid;
    return User.find(id, function(err, user) {
      if (err != null) {
        return next(err);
      } else {
        return ds.del("access/" + id + "/", function(err, response, body) {
          if (err) {
            log.error(err);
          }
          return user.destroy(function(err) {
            err = err || body.error;
            if (err != null) {
              return next(err);
            } else {
              return res.send(200, {
                success: true
              });
            }
          });
        });
      }
    });
  }
};
